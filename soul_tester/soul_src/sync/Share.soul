import Std::Sync::[Mutex, Arc]

class Share<T> {
    inner: Arc<Mutex<T>>

    This(value: T) {
        return This{inner: Arc(Mutex(value))}
    }
    
    impl Send{}
    impl Sync{}
    impl CopyAuto {}
    impl ConstRef<T> {
        ConstRef(@'a this) -> @'a T 
            => @inner.Lock()
    }

    impl MutRef<T> {
        MutRef(&'a this) -> &'a T 
            => &inner.Lock()
    }
}